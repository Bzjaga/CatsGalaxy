#Choosing Shroudwalker Enclave To Generate
choose_shroudwalker_enclave_country = {
	if = {
		limit = {
			NOT = { any_country = { has_origin = origin_imperial_vassal } }
		}
		if = {
			limit = {
				any_system = { has_star_flag = mraxist }
			}
			set_planet_flag = enclave_dialectics
		}
		else = {
			set_planet_flag = enclave_shroudwalker_default
		}
	}
	else = {
		event_target:shroudwalker_enclave_system = {
			choose_imperial_overlord_country = yes
		}
		if = {
			limit = {
				any_system = { has_star_flag = is_chosen_overlord_soviet }
			}
			if = {
				limit = {
					AND = {
						galaxy_size = tiny
						NOT = { any_system = { has_star_flag = international } }
					}
				}
				set_planet_flag = enclave_shroudwalker_default
			}
			else = {
				set_planet_flag = enclave_dialectics
			}
		}
		else = {
			set_planet_flag = enclave_shroudwalker_default
		}
	}
}

#Choosing Overlord To Generate
choose_imperial_overlord_country = {
	if = { # Overlord Post-Soviet
		limit = {
			AND = {
				any_system = { has_star_flag = zaharova }
				any_system = { has_star_flag = lukashenko }
			}
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = deyatel
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		set_star_flag = is_chosen_overlord_post_soviet
	}
	else_if = { # Overlord Soviet
		limit = {
			AND = {
				any_system = { has_star_flag = mao }
				any_system = { has_star_flag = deyatel }
			}
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = zaharova
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = lukashenko
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			give_technology = { tech = tech_genome_mapping }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = pamyatnik
					}
				}
			}
			set_origin = origin_imperial_vassal
		}
		set_star_flag = is_chosen_overlord_soviet
	}
	else_if = { # Overlord Post-Soviet
		limit = {
			any_system = { has_star_flag = zaharova }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = deyatel
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		set_star_flag = is_chosen_overlord_post_soviet
	}
	else_if = { # Overlord Soviet
		limit = {
			any_system = { has_star_flag = mao }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = zaharova
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = lukashenko
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			give_technology = { tech = tech_genome_mapping }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = pamyatnik
					}
				}
			}
			set_origin = origin_imperial_vassal
		}
		set_star_flag = is_chosen_overlord_soviet
	}
	else_if = { # Overlord Post-Soviet
		limit = {
			any_system = { has_star_flag = lukashenko }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = deyatel
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		set_star_flag = is_chosen_overlord_post_soviet
	}
	else_if = { # Overlord Soviet
		limit = {
			any_system = { has_star_flag = deyatel }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = zaharova
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = lukashenko
					}
				}
			}
			capital_scope = {
				while = {
					count = 4
					create_pop = {
						species = owner_main_species
						ethos = random
					}
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_farming
				}
				add_district_and_planet_size_if_needed_effect = {
					district = district_generator
				}
			}
			set_origin = origin_default
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = mao
					}
				}
			}
			give_technology = { tech = tech_genome_mapping }
		}
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = pamyatnik
					}
				}
			}
			set_origin = origin_imperial_vassal
		}
		set_star_flag = is_chosen_overlord_soviet
	}
	else = {
		set_star_flag = is_chosen_overlord_soviet
		every_playable_country = {
			limit = {
				capital_scope = {
					solar_system = {
						has_star_flag = pamyatnik
					}
				}
			}
			set_origin = origin_imperial_vassal
		}
	}
}

create_fear_of_the_dark_country_korea = {
	create_country = {
		name = {
			key = "КНДР"
		}
		adjective="Северокорейск"
		authority = auth_imperial
		civics = {
			civic = civic_corvee_system
			civic = civic_distinguished_admiralty
		}
		species = event_target:fotd_country.species
		ethos = {
			ethic = ethic_fanatic_xenophobe
			ethic = ethic_militarist
		}

		flag = random
		origin = "origin_fear_of_the_dark" # Should only be visible if they become spacefaring
		type = primitive
		effect = {
			set_country_flag = early_space_age
			set_country_flag = fotd_seperatist_country@event_target:fotd_country
			set_country_flag = fotd_seperatist_country
			save_event_target_as = fotd_seperatist_country
			establish_communications_no_message = event_target:fotd_country
			set_faction_hostility = {
				target = event_target:fotd_country
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}

			# Leader
			create_leader = {
				class = official
				species = event_target:fotd_country.species
				name = "Ким Кимыч"
				gender=male
				skill = 1
				traits = {
					trait = trait_ruler_industrialist
				}
			}
			set_male_ruler_title = "Претворитель Чучхе"
			set_female_ruler_title = "Претворительница Чучхе"
			set_leader = last_created_leader
			set_male_heir_title = "Первоочередной председатель"
			set_female_heir_title = "Первоочередная председатель"
		}
	}
	event_target:fotd_country = {
		add_intel = {
			amount = 100
			who = event_target:fotd_country
		}
	}
}

setup_fear_of_the_dark_pre_ftl_korea = {
	set_owner = event_target:fotd_seperatist_country
	set_capital = yes
	set_name = {
		key="Пхеньян"
		literal=yes
	}
	event_target:fotd_country.home_planet = {
	}
	while = {
		count = 2
		add_district_and_planet_size_if_needed_effect = {
			district = district_city
		}
	}
	while = {
		count = 1
		add_district_and_planet_size_if_needed_effect = {
			district = district_industrial
		}
	}
	while = {
		count = 1
		add_district_and_planet_size_if_needed_effect = {
			district = district_farming
		}
	}
	remove_building = building_colony_shelter
	add_building = building_primitive_capital
	add_building = building_research_lab_1
	while = {
		count = 10
		create_pop = {
			species = event_target:fotd_country.species
		}
	}
	event_target:fotd_seperatist_country = {
		start_situation = {
			type = situation_fotd_terraforming
			target = prev
		}
		set_country_flag = early_space_age
		set_pre_ftl_age = early_space_age
		change_country_flag = {
			icon={
				category="human"
				file="flag_human_12.dds"
			}
			background={
				category="backgrounds"
				file="flag_BG_31.dds"
			}
			colors={
				"red"
				"dark_blue"
				"black"
				"null"
			}
		}
		set_country_flag = tech_frozen
		add_awareness = 100
	}
}

create_shroudwalker_enclave_country_default = {
	create_species = {
		homeworld = this
		name = random
		class = SHROUDWALKER
		namelist = NECROID1
		portrait = random
		traits = {
			ideal_planet_class = pc_habitat
			trait = trait_psionic
			trait = random_traits
		}
	}
	last_created_species = {
		save_event_target_as = shroudwalker_enclave_species
	}
	create_country = {
		name = random
		type = enclave
		authority = "auth_oligarchic"
		civics = {
			civic = civic_shroudwalker_enclave
		}
		origin = "origin_default"
		species = event_target:shroudwalker_enclave_species
		flag = {
			icon = {
				category = "special"
				file = "shroudwalkers.dds"
			}
			background = {
				category = "backgrounds"
				file = "sinus.dds"
			}
			colors = {
				"black"
				"purple"
				"null"
				"null"
			}
		}
		ethos = {
			ethic = ethic_fanatic_spiritualist
			ethic = ethic_egalitarian
		}
		ignore_initial_colony_error = yes
		effect = {
			save_global_event_target_as = shroudwalker_enclave_country
			set_country_flag = enclave_shroudwalker_default
			set_country_flag = shroudwalker_enclave_country
			set_graphical_culture = mammalian_01
			#Create capital starbase
			create_fleet = {
				name = "NAME_Shroud_Teachers"
				settings = { spawn_debris = no }
				effect = {
					set_owner = prev
					create_ship = {
						name = random
						design = "NAME_Shroudwalker_Enclave_Station"
						graphical_culture = prev
					}
					set_location = {
						target = event_target:shroudwalker_enclave_planet
						distance = 20
					}
					save_event_target_as = CustomCapital
				}
			}
			set_custom_capital_location = event_target:shroudwalker_enclave_planet
			#Create ruler
			create_leader = {
				name = random
				class = random_ruler
				species = event_target:shroudwalker_enclave_species
				skill = 5
				traits = {
					trait = leader_trait_expertise_psionics
				}
			}
			set_leader = last_created_leader
		}
	}
}

create_shroudwalker_enclave_country_dialectics = {
	create_species = {
		homeworld = this
		name = "Диалектик"
		class = SHROUDWALKER
		namelist = HUMAN1
		portrait = random
		traits = {
			ideal_planet_class = pc_habitat
			trait = trait_psionic
			trait = random_traits
		}
	}
	last_created_species = {
		save_event_target_as = shroudwalker_enclave_species
	}
	create_country = {
		name = {
			key="Красный Университет"
			literal=yes
		}
		type = enclave
		authority = "auth_oligarchic"
		civics = {
			civic = civic_shroudwalker_enclave
		}
		origin = "origin_default"
		species = event_target:shroudwalker_enclave_species
		flag = {
			icon={
				category="human"
				file="flag_human_5.dds"
			}
			background={
				category="backgrounds"
				file="00_solid.dds"
			}
			colors={
				"red"
				"red"
				"black"
				"null"
			}
		}
		ethos = {
			ethic = ethic_fanatic_spiritualist
			ethic = ethic_egalitarian
		}
		ignore_initial_colony_error = yes
		effect = {
			save_global_event_target_as = shroudwalker_enclave_country
			set_country_flag = enclave_dialectics
			set_country_flag = shroudwalker_enclave_country
			set_graphical_culture = mammalian_01
			#Create capital starbase
			create_fleet = {
				name = "Красный Университет"
				settings = { spawn_debris = no }
				effect = {
					set_owner = prev
					create_ship = {
						name = "Красный Университет"
						design = "NAME_Shroudwalker_Enclave_Station"
						graphical_culture = prev
					}
					set_location = {
						target = event_target:shroudwalker_enclave_planet
						distance = 20
					}
					save_event_target_as = CustomCapital
				}
			}
			set_custom_capital_location = event_target:shroudwalker_enclave_planet
			#Create ruler
			create_leader = {
				name = "Попов Михаил Васильевич"
				class = scientist
				species = event_target:shroudwalker_enclave_species
				skill = 5
				traits = {
					trait = leader_trait_expertise_psionics
				}
			}
			set_male_ruler_title = "Идущий Сквозь Диалектику"
			set_female_ruler_title = "Идущая Сквозь Диалектику"
			set_leader = last_created_leader
		}
	}
}

#For use in overlord initializer; enclave country scope
create_shroudwalker_enclave_starbase_dialectics_01 = {
	create_fleet = {
		name = "МЭЛС"
		settings = { spawn_debris = no }
		effect = {
			set_owner = prev
			create_ship = {
				name = "МЭЛС"
				design = "NAME_Shroudwalker_Enclave_Station"
				graphical_culture = prev
			}
			set_location = {
				target = event_target:shroudwalker_enclave_planet
				distance = 20
			}
			save_global_event_target_as = shroudwalker_starbase
		}
	}
}

#For use in overlord initializer; enclave country scope
create_shroudwalker_enclave_starbase_dialectics_02 = {
	create_fleet = {
		name = "Фонд Рабочей Академии"
		settings = { spawn_debris = no }
		effect = {
			set_owner = prev
			create_ship = {
				name = "Фонд Рабочей Академии"
				design = "NAME_Shroudwalker_Enclave_Station"
				graphical_culture = prev
			}
			set_location = {
				target = event_target:shroudwalker_enclave_planet
				distance = 20
			}
			save_global_event_target_as = shroudwalker_starbase
		}
	}
}

#For use in overlord initializer; enclave country scope
create_shroudwalker_enclave_starbase_dialectics_03 = {
	create_fleet = {
		name = "Красный кодекс"
		settings = { spawn_debris = no }
		effect = {
			set_owner = prev
			create_ship = {
				name = "Красный кодекс"
				design = "NAME_Shroudwalker_Enclave_Station"
				graphical_culture = prev
			}
			set_location = {
				target = event_target:shroudwalker_enclave_planet
				distance = 20
			}
			save_global_event_target_as = shroudwalker_starbase
		}
	}
}

#For use in overlord initializer; planet scope
create_overlord_soviet = {
	
}

